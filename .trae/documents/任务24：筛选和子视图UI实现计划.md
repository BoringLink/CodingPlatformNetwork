# 任务24：筛选和子视图UI实现计划

## 1. 任务概述
实现知识图谱可视化的筛选和子视图管理功能，包括创建筛选面板组件、实现时间范围筛选、节点类型筛选、关系类型筛选以及子视图创建和管理。

## 2. 现有基础
- API客户端已实现（`lib/api-client.ts`）
- 图可视化组件已实现（`components/graph-visualization.tsx`）
- 图数据hook已实现（`hooks/use-graph-data.ts`）
- 状态管理已配置（`store/graph-store.ts`）

## 3. 实现步骤

### 3.1 创建筛选面板组件
- 创建 `components/filter-panel.tsx` 组件
- 实现可折叠的筛选面板布局
- 集成到图可视化页面

### 3.2 实现节点类型筛选
- 实现节点类型多选功能
- 使用 Checkbox 组件实现选择界面
- 集成到筛选面板
- 更新图数据查询逻辑

### 3.3 实现关系类型筛选
- 实现关系类型多选功能
- 使用 Checkbox 组件实现选择界面
- 集成到筛选面板
- 更新图数据查询逻辑

### 3.4 实现时间范围筛选
- 实现时间范围选择器
- 使用 DatePicker 组件（需要安装和配置）
- 集成到筛选面板
- 更新图数据查询逻辑

### 3.5 实现筛选应用功能
- 添加 "应用筛选" 按钮
- 实现筛选条件的合并和应用
- 更新可视化数据
- 实现筛选重置功能

### 3.6 实现子视图创建功能
- 创建 `components/subview-manager.tsx` 组件
- 实现子视图命名和创建界面
- 集成到筛选面板或侧边栏
- 调用后端API创建子视图

### 3.7 实现子视图管理功能
- 实现子视图列表展示
- 实现子视图切换功能
- 实现子视图编辑和删除功能
- 集成到页面布局

### 3.8 实现子视图状态保持
- 确保子视图的筛选条件持久化
- 实现子视图切换时的状态恢复
- 集成到状态管理

### 3.9 整合到页面组件
- 更新 `app/graph/[[...params]]/page.tsx` 页面
- 整合所有筛选和子视图组件
- 实现完整的交互流程

## 4. 技术实现细节

### 4.1 筛选面板组件
```typescript
// 组件结构
function FilterPanel({
  nodeTypes,
  relationshipTypes,
  dateRange,
  onNodeTypeChange,
  onRelationshipTypeChange,
  onDateRangeChange,
  onApplyFilters,
  onResetFilters,
}: FilterPanelProps) {
  // 实现筛选面板逻辑
}
```

### 4.2 子视图管理器组件
```typescript
// 组件结构
function SubviewManager({
  subviews,
  currentSubviewId,
  onSelectSubview,
  onCreateSubview,
  onEditSubview,
  onDeleteSubview,
}: SubviewManagerProps) {
  // 实现子视图管理逻辑
}
```

### 4.3 状态管理集成
- 更新 `store/graph-store.ts`，添加筛选和子视图相关状态
- 实现筛选条件的保存和恢复
- 支持子视图的切换和管理

### 4.4 API集成
- 使用现有的 `apiClient` 调用子视图相关API
- 集成TanStack Query管理子视图数据
- 实现子视图数据的缓存和失效

## 5. 测试计划
- 测试筛选条件的应用和重置
- 测试子视图的创建、切换和删除
- 测试筛选条件与子视图的交互
- 测试响应式设计

## 6. 依赖和资源
- 现有组件库（shadcn/ui）
- DatePicker组件（需要安装）
- 现有API和hook

## 7. 预期成果
- 实现完整的筛选和子视图管理功能
- 提供直观的用户界面
- 支持复杂的筛选条件组合
- 支持子视图的创建、编辑和删除
- 实现筛选条件的持久化
- 提供良好的用户体验