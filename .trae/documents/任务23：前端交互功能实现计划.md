# 任务23：前端交互功能实现计划

## 1. 任务概述
实现知识图谱可视化的交互功能，包括节点悬停显示详情、节点点击高亮邻居、缩放和拖拽、节点选择等。

## 2. 当前实现分析
- 图可视化组件已支持基本的节点点击和悬停事件
- 状态管理已配置（graph-store.ts）
- API客户端已准备（lib/api-client.ts）
- 缺少节点详情展示、邻居高亮、完整的交互功能

## 3. 实现步骤

### 3.1 实现节点详情弹窗组件
- 创建 `components/node-details-dialog.tsx` 组件
- 支持展示节点的详细信息（类型、属性、关联关系）
- 使用 shadcn/ui Dialog 组件实现
- 集成到图可视化交互中

### 3.2 实现邻居节点高亮功能
- 在 `graph-visualization.tsx` 中添加高亮逻辑
- 当点击节点时，高亮其所有直接邻居节点和关联边
- 更新 `graph-store.ts` 状态管理，添加高亮节点列表
- 实现高亮样式（不同颜色和边框）

### 3.3 增强节点悬停效果
- 完善悬停事件处理
- 显示节点的基本信息提示
- 实现平滑的视觉反馈

### 3.4 实现缩放和拖拽功能
- 配置 Cytoscape.js 支持缩放和拖拽
- 添加缩放控制按钮
- 实现视图重置功能

### 3.5 完善节点选择功能
- 实现单选和多选支持
- 添加选中状态的视觉反馈
- 实现取消选择功能

### 3.6 整合到页面组件
- 更新 `app/graph/[[...params]]/page.tsx` 页面
- 实现完整的交互流程
- 集成状态管理

### 3.7 添加交互状态管理
- 更新 `store/graph-store.ts`，添加交互相关状态
- 实现交互动作的状态更新
- 支持历史记录和撤销操作

## 4. 技术实现细节

### 4.1 节点详情弹窗
```typescript
// 组件结构
function NodeDetailsDialog({
  node,
  isOpen,
  onClose,
}: {
  node: VisualizationNode | null;
  isOpen: boolean;
  onClose: () => void;
}) {
  // 实现详情展示逻辑
}
```

### 4.2 邻居高亮实现
```typescript
// 在 graph-visualization.tsx 中
const handleNodeClick = (nodeId: string) => {
  // 获取邻居节点
  const neighbors = getNeighbors(nodeId, nodes, edges);
  // 更新高亮状态
  onHighlightNodes?.(neighbors);
  // 触发回调
  onNodeClick?.(nodeId);
};
```

### 4.3 缩放控制实现
```typescript
// 添加缩放控制按钮
function ZoomControls() {
  const zoomIn = () => cytoscapeRef.current?.cy.zoomIn();
  const zoomOut = () => cytoscapeRef.current?.cy.zoomOut();
  const resetView = () => cytoscapeRef.current?.cy.fit(undefined, 50);
  // 渲染控制按钮
}
```

## 5. 测试计划
- 测试节点悬停显示详情功能
- 测试节点点击高亮邻居功能
- 测试缩放和拖拽功能
- 测试节点选择功能
- 测试交互状态管理

## 6. 依赖和资源
- 现有 Cytoscape.js 配置
- shadcn/ui 组件库
- Zustand 状态管理
- 现有的 API 客户端

## 7. 预期成果
- 实现完整的图可视化交互功能
- 提供良好的用户体验
- 支持深入探索知识图谱
- 为后续功能（筛选、子视图）奠定基础