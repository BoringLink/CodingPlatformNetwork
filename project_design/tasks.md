# 实施计划

- [x] 1. 项目初始化和基础设施搭建
  - 创建项目目录结构（backend、frontend、docker）
  - 初始化Python项目（uv init，配置pyproject.toml）
  - 初始化Next.js项目（create-next-app）
  - 配置Docker Compose（Neo4j、Redis、PostgreSQL、后端、前端）
  - 设置开发环境配置文件（.env.example）
  - _需求: 所有需求的基础_

- [x] 2. 后端核心架构实现
  - 创建FastAPI应用结构（app/main.py、routers、services、models）
  - 配置Pydantic v2数据模型和验证
  - 实现配置管理（使用pydantic-settings）
  - 设置CORS和中间件
  - 配置structlog结构化日志
  - _需求: 所有需求的基础_

- [ ]* 2.1 编写后端核心架构的单元测试
  - 测试FastAPI应用启动
  - 测试配置加载
  - 测试中间件功能
  - _需求: 所有需求的基础_

- [x] 3. Neo4j图数据库集成
  - 配置Neo4j连接（neo4j-driver）
  - 实现连接池管理
  - 创建数据库约束和索引（Cypher脚本）
  - 实现GraphManagementService基础接口
  - _需求: 1.1, 1.2, 1.3, 5.1_

- [x] 3.1 实现节点创建功能
  - 实现createNode方法（支持所有节点类型）
  - 实现节点唯一性检查
  - 实现节点属性验证
  - _需求: 1.1, 1.2, 1.3_

- [ ]* 3.2 编写属性测试：节点创建完整性
  - **属性 1: 节点创建完整性**
  - **验证: 需求 1.1**

- [ ]* 3.3 编写属性测试：节点唯一性
  - **属性 2: 节点唯一性**
  - **验证: 需求 1.2**

- [ ]* 3.4 编写属性测试：属性持久化
  - **属性 3: 属性持久化**
  - **验证: 需求 1.3**

- [x] 3.5 实现节点合并功能
  - 实现mergeNodes方法
  - 处理重复节点检测
  - 合并节点属性和关系
  - _需求: 1.4_

- [ ]* 3.6 编写属性测试：重复节点合并
  - **属性 4: 重复节点合并**
  - **验证: 需求 1.4**

- [x] 4. 关系管理实现
  - 实现createRelationship方法（支持所有关系类型）
  - 实现关系属性管理
  - 实现关系权重计算
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ]* 4.1 编写属性测试：学生互动关系创建
  - **属性 5: 学生互动关系创建**
  - **验证: 需求 2.1**

- [ ]* 4.2 编写属性测试：师生互动关系创建
  - **属性 6: 师生互动关系创建**
  - **验证: 需求 2.2**

- [ ]* 4.3 编写属性测试：学习关系完整性
  - **属性 7: 学习关系完整性**
  - **验证: 需求 2.3**

- [ ]* 4.4 编写属性测试：课程知识点关联
  - **属性 8: 课程知识点关联**
  - **验证: 需求 2.4**

- [ ]* 4.5 编写属性测试：错误关系网络
  - **属性 9: 错误关系网络**
  - **验证: 需求 2.5**

- [x] 5. 阿里云通义千问LLM集成（基于专家建议优化）
  - 配置阿里云DashScope SDK（使用OpenAI兼容接口）
  - 实现LLMAnalysisService基础接口（支持多模型调用）
  - 实现API密钥管理和环境配置
  - 实现重试机制（指数退避）
  - 实现智能缓存机制（基于输入内容哈希）
  - 实现成本控制和使用统计
  - _需求: 3.1, 3.2, 3.3, 3.4_

- [x] 5.1 实现结构化数据筛查和分类
  - 实现screenAndClassifyData方法（使用qwen-turbo，免费额度充足）
  - 设计提示模板（数据筛查、实体分类）
  - 实现结构化JSON输出解析
  - 实现数据有效性验证
  - _需求: 3.1, 1.1_

- [x] 5.2 实现互动内容分析
  - 实现analyzeInteraction方法（使用qwen-turbo，适合简单分类）
  - 设计提示模板（情感分析、主题提取、互动类型识别）
  - 实现结构化JSON输出解析
  - _需求: 3.1_

- [ ]* 5.2 编写属性测试：LLM分析调用
  - **属性 10: LLM分析调用**
  - **验证: 需求 3.1**

- [x] 5.3 实现错误记录分析
  - 实现analyzeError方法（使用qwen-2.5-72b-instruct，中等复杂度任务）
  - 设计提示模板（错误类型识别、知识点推断、严重程度评估）
  - 实现置信度评分和课程上下文处理
  - _需求: 3.2_

- [ ]* 5.4 编写属性测试：错误类型识别
  - **属性 11: 错误类型识别**
  - **验证: 需求 3.2**

- [x] 5.5 实现知识点提取
  - 实现extractKnowledgePoints方法（使用qwen-2.5-72b-instruct，复杂推理任务）
  - 设计提示模板（知识点提取、依赖关系识别、分类归类）
  - 实现知识点去重和嵌入向量生成
  - _需求: 3.3_

- [ ]* 5.6 编写属性测试：知识点提取
  - **属性 12: 知识点提取**
  - **验证: 需求 3.3**

- [x] 5.7 实现节点嵌入向量生成
  - 实现generateEmbedding方法（使用text-embedding-v2）
  - 实现批量嵌入生成优化
  - 实现相似实体检测和合并（detectSimilarEntities）
  - _需求: 1.4, 3.4_

- [x] 5.8 实现LLM结果结构化转换
  - 实现分析结果到节点属性的转换
  - 实现分析结果到关系数据的转换
  - 处理LLM输出验证和错误恢复
  - 实现成本统计和使用监控
  - _需求: 3.4_

- [ ]* 5.9 编写属性测试：LLM结果结构化
  - **属性 13: LLM结果结构化**
  - **验证: 需求 3.4**

- [x] 6. Redis缓存实现
  - 配置Redis连接
  - 实现LLM响应缓存（基于输入哈希）
  - 实现缓存过期策略
  - 实现缓存统计和监控
  - _需求: 3.1, 3.2, 3.3（优化性能）_

- [x] 7. 数据导入服务实现
  - 实现DataImportService接口
  - 实现数据验证器（Pydantic模型）
  - 实现批处理逻辑（每批1000条）
  - 实现进度跟踪
  - _需求: 1.1, 1.5, 7.1, 7.3_

- [ ]* 7.1 编写属性测试：批处理大小限制
  - **属性 27: 批处理大小限制**
  - **验证: 需求 7.1**

- [ ]* 7.2 编写属性测试：导入进度可追踪
  - **属性 29: 导入进度可追踪**
  - **验证: 需求 7.3**

- [x] 8. Celery任务队列集成
  - 配置Celery和Redis
  - 创建异步任务（数据导入、LLM分析）
  - 实现任务重试和错误处理
  - 配置Flower监控
  - _需求: 7.2, 8.1_

- [ ]* 8.1 编写属性测试：LLM速率限制遵守
  - **属性 28: LLM速率限制遵守**
  - **验证: 需求 7.2**

- [x] 9. 多课程多错误处理实现
  - 实现学生多课程错误记录创建
  - 实现错误类型多知识点关联
  - 实现错误统计聚合功能
  - 实现跨课程知识点路径查询
  - 实现重复错误权重更新
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 9.1 编写属性测试：多课程错误独立性
  - **属性 14: 多课程错误独立性**
  - **验证: 需求 4.1**

- [ ]* 9.2 编写属性测试：多知识点错误关联
  - **属性 15: 多知识点错误关联**
  - **验证: 需求 4.2**

- [ ]* 9.3 编写属性测试：错误统计聚合
  - **属性 16: 错误统计聚合**
  - **验证: 需求 4.3**

- [ ]* 9.4 编写属性测试：跨课程知识点路径
  - **属性 17: 跨课程知识点路径**
  - **验证: 需求 4.4**

- [ ]* 9.5 编写属性测试：重复错误权重增加
  - **属性 18: 重复错误权重增加**
  - **验证: 需求 4.5**

- [x] 10. 检查点 - 确保所有后端核心功能测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 11. 图查询服务实现
  - 实现QueryService接口
  - 实现节点查询（支持类型、属性、日期范围过滤）
  - 实现关系查询
  - 实现子图查询（指定深度）
  - 实现路径查询
  - _需求: 5.2, 6.1, 6.2_

- [ ]* 11.1 编写属性测试：持久化往返一致性
  - **属性 19: 持久化往返一致性**
  - **验证: 需求 5.1**

- [ ]* 11.2 编写属性测试：图查询正确性
  - **属性 20: 图查询正确性**
  - **验证: 需求 5.2**

- [ ]* 11.3 编写属性测试：学生子图完整性
  - **属性 23: 学生子图完整性**
  - **验证: 需求 6.1**

- [ ]* 11.4 编写属性测试：知识点查询准确性
  - **属性 24: 知识点查询准确性**
  - **验证: 需求 6.2**

- [x] 12. 增量更新和事务支持
  - 实现增量更新逻辑
  - 实现批量操作事务
  - 实现冲突解决策略
  - _需求: 5.3, 5.4, 5.5_

- [ ]* 12.1 编写属性测试：增量更新一致性
  - **属性 21: 增量更新一致性**
  - **验证: 需求 5.3**

- [ ]* 12.2 编写属性测试：批量操作原子性
  - **属性 22: 批量操作原子性**
  - **验证: 需求 5.5**

- [x] 13. 可视化服务实现
  - 实现VisualizationService接口
  - 实现子图到可视化数据的转换
  - 实现节点颜色和形状映射
  - 实现布局配置
  - _需求: 6.3, 6.5_

- [ ]* 13.1 编写属性测试：可视化数据完整性
  - **属性 25: 可视化数据完整性**
  - **验证: 需求 6.3**

- [ ]* 13.2 编写属性测试：节点类型视觉区分
  - **属性 26: 节点类型视觉区分**
  - **验证: 需求 6.5**

- [x] 14. 子视图管理实现
  - 实现子视图创建（基于筛选条件）
  - 实现子视图存储和检索
  - 实现筛选条件应用
  - 实现子视图状态管理
  - _需求: 9.3, 9.4, 9.5_

- [ ] 14.1 编写属性测试：筛选条件应用
  - **属性 33: 筛选条件应用**
  - **验证: 需求 9.3**

- [ ]* 14.2 编写属性测试：子视图数据隔离
  - **属性 34: 子视图数据隔离**
  - **验证: 需求 9.4**

- [ ]* 14.3 编写属性测试：子视图状态保持
  - **属性 35: 子视图状态保持**
  - **验证: 需求 9.5**

- [x] 15. 节点详情和交互功能
  - 实现getNodeDetails方法
  - 实现直接邻居查询
  - 实现关系统计
  - _需求: 9.1, 9.2_

- [ ]* 15.1 编写属性测试：节点详情完整性
  - **属性 31: 节点详情完整性**
  - **验证: 需求 9.1**

- [ ]* 15.2 编写属性测试：邻居节点识别
  - **属性 32: 邻居节点识别**
  - **验证: 需求 9.2**

- [x] 16. 分析报告生成实现
  - 实现图谱统计功能（节点数量、类型分布）
  - 实现学生表现分析（高频错误识别）
  - 实现课程效果分析（参与度、错误率）
  - 实现互动模式分析（社交网络、孤立节点）
  - 实现报告导出（JSON、PDF）
  - _需求: 10.1, 10.2, 10.3, 10.4, 10.5_

- [ ]* 16.1 编写属性测试：报告统计准确性
  - **属性 36: 报告统计准确性**
  - **验证: 需求 10.1**

- [ ]* 16.2 编写属性测试：高频错误识别
  - **属性 37: 高频错误识别**
  - **验证: 需求 10.2**

- [ ]* 16.3 编写属性测试：课程指标计算
  - **属性 38: 课程指标计算**
  - **验证: 需求 10.3**

- [ ]* 16.4 编写属性测试：社交网络识别
  - **属性 39: 社交网络识别**
  - **验证: 需求 10.4**

- [ ]* 16.5 编写属性测试：报告格式正确性
  - **属性 40: 报告格式正确性**
  - **验证: 需求 10.5**

- [x] 17. REST API端点实现
  - 实现数据导入API（POST /api/import）
  - 实现节点查询API（GET /api/nodes）
  - 实现关系查询API（GET /api/relationships）
  - 实现子图查询API（GET /api/subgraph）
  - 实现可视化API（GET /api/visualization）
  - 实现子视图API（POST/GET /api/subviews）
  - 实现节点详情API（GET /api/nodes/{id}/details）
  - 实现报告生成API（GET /api/reports）
  - _需求: 所有需求_

- [ ]* 17.1 编写API端点单元测试
  - 测试所有端点的请求/响应
  - 测试错误处理
  - 测试数据验证
  - _需求: 所有需求_

- [x] 18. 错误处理和日志实现
  - 实现全局异常处理器
  - 实现错误日志记录
  - 实现操作日志记录
  - 实现重试机制
  - 实现降级策略
  - _需求: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ]* 18.1 编写属性测试：操作日志记录
  - **属性 30: 操作日志记录**
  - **验证: 需求 8.4**

- [x] 19. 检查点 - 确保所有后端功能和API测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 20. 前端项目初始化
  - 配置Next.js 15项目
  - 配置TypeScript和ESLint
  - 配置Tailwind CSS
  - 安装shadcn/ui组件
  - 配置TanStack Query
  - 配置Zustand状态管理
  - _需求: 前端基础_

- [ ] 21. API客户端实现
  - 创建API客户端（使用fetch或axios）
  - 实现类型定义（TypeScript接口）
  - 配置TanStack Query hooks
  - 实现错误处理
  - _需求: 前端基础_

- [ ] 22. 图可视化组件实现
  - 安装Cytoscape.js和react-cytoscapejs
  - 创建GraphVisualization组件
  - 实现节点和边的渲染
  - 实现节点颜色和形状映射
  - 实现布局算法配置
  - _需求: 6.3, 6.5_

- [ ] 23. 交互功能实现
  - 实现节点悬停显示详情
  - 实现节点点击高亮邻居
  - 实现缩放和拖拽
  - 实现节点选择
  - _需求: 9.1, 9.2_

- [ ] 24. 筛选和子视图UI实现
  - 创建筛选面板组件
  - 实现时间范围筛选
  - 实现节点类型筛选
  - 实现关系类型筛选
  - 实现子视图创建和管理
  - _需求: 9.3, 9.4, 9.5_

- [ ] 25. 数据导入UI实现
  - 创建数据导入页面
  - 实现文件上传
  - 实现进度显示
  - 实现错误反馈
  - _需求: 7.3_

- [ ] 26. 报告展示UI实现
  - 创建报告页面
  - 实现统计图表（使用Chart.js或Recharts）
  - 实现报告导出功能
  - _需求: 10.1, 10.2, 10.3, 10.4, 10.5_

- [ ] 27. 响应式设计和样式优化
  - 实现移动端适配
  - 优化UI组件样式
  - 实现暗色模式支持
  - _需求: 用户体验_

- [ ]* 27.1 编写前端组件单元测试
  - 测试GraphVisualization组件
  - 测试筛选面板组件
  - 测试数据导入组件
  - _需求: 前端质量保证_

- [ ] 28. 端到端集成测试
  - 使用Playwright编写E2E测试
  - 测试完整的数据导入流程
  - 测试图谱可视化和交互
  - 测试子视图创建和使用
  - 测试报告生成
  - _需求: 所有需求_

- [ ] 29. 性能优化
  - 优化图查询性能
  - 优化LLM调用（缓存、批处理）
  - 优化前端渲染（虚拟化、懒加载）
  - 优化大规模图可视化
  - _需求: 7.1, 7.2, 7.5_

- [ ] 30. 文档编写
  - 编写API文档（使用FastAPI自动生成）
  - 编写部署文档
  - 编写用户手册
  - 编写开发者指南
  - _需求: 项目交付_

- [ ] 31. 最终检查点 - 确保所有功能完整且测试通过
  - 确保所有测试通过，如有问题请询问用户
